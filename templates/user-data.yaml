---
#cloud-config
users:
  - name: ${sshUserName}
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: users, admin
    lock_passwd: true
    ssh_authorized_keys:
      - ${sshPubKey}

packages:
  - podman
  - git
  - jq
  - vim

yum_repos:
  epel:
    baseurl: https://dl.fedoraproject.org/pub/epel/7/x86_64/
    enabled: true
    gpgcheck: false
    name: Extra Packages for Enterprise Linux 7

write_files:
      - content: |
          # This file controls the state of SELinux on the system.
          # SELINUX= can take one of these three values:
          #     enforcing - SELinux security policy is enforced.
          #     permissive - SELinux prints warnings instead of enforcing.
          #     disabled - No SELinux policy is loaded.
          SELINUX=permissive
          # SELINUXTYPE= can take one of these three values:
          #     targeted - Targeted processes are protected,
          #     minimum - Modification of targeted policy. Only selected processes are protected.
          #     mls - Multi Level Security protection.
          SELINUXTYPE=targeted
        owner: root:root
        path: /etc/selinux/config
        permissions: '0644'

      - encoding: b64
        content: W1VuaXRdCkRlc2NyaXB0aW9uPSJIYXNoaUNvcnAgQ29uc3VsIgpEb2N1bWVudGF0aW9uPWh0dHBzOi8vd3d3LmNvbnN1bC5pby8KUmVxdWlyZXM9bmV0d29yay1vbmxpbmUudGFyZ2V0CkFmdGVyPW5ldHdvcmstb25saW5lLnRhcmdldAoKW1NlcnZpY2VdClJlc3RhcnQ9b24tZmFpbHVyZQpFbnZpcm9ubWVudD1DT05TVUxfREFUQT0vb3B0L2NvbnN1bApFbnZpcm9ubWVudD1JTUFHRT1kb2NrZXIuaW8vbGlicmFyeS9jb25zdWwKRW52aXJvbm1lbnQ9VEFHPTEuNy4yCkV4ZWNTdGFydFByZT0vYmluL21rZGlyIC1wICR7Q09OU1VMX0RBVEF9CkV4ZWNTdGFydFByZT0vYmluL2Nob3duIC1SIDEwMDoxMDAwICR7Q09OU1VMX0RBVEF9CkV4ZWNTdGFydFByZT0vdXNyL2Jpbi9ybSAtZiAvJXQvJW4tcGlkIC8ldC8lbi1jaWQKRXhlY1N0YXJ0PS91c3IvYmluL3BvZG1hbiBydW4gLS1jb25tb24tcGlkZmlsZSAvJXQvJW4tcGlkIC0tY2lkZmlsZSAvJXQvJW4tY2lkIC0tbG9nLWRyaXZlcj1qb3VybmFsZCAgLS1uYW1lIGNvbnN1bCAtdiAke0NPTlNVTF9EQVRBfToke0NPTlNVTF9EQVRBfSAtZSAiQ09OU1VMX0RBVEE9JHtDT05TVUxfREFUQX0iICAtcCA4NTAwOjg1MDAgLXAgIDg2MDA6ODYwMC91ZHAgIC1kICAke0lNQUdFfToke1RBR30gYWdlbnQgLXNlcnZlciAtdWkgLW5vZGU9c2VydmVyLTEgLWJvb3RzdHJhcC1leHBlY3Q9MSAtY2xpZW50PTAuMC4wLjAgLXVpICAtam9pbiAxMjcuMC4wLjEgLWRhdGEtZGlyPSR7Q09OU1VMX0RBVEF9CkV4ZWNTdG9wPS91c3IvYmluL3NoIC1jICIvdXNyL2Jpbi9wb2RtYW4gcm0gLWYgYGNhdCAvJXQvJW4tY2lkYCIKS2lsbE1vZGU9bm9uZQpUeXBlPWZvcmtpbmcKUElERmlsZT0vJXQvJW4tcGlkCgpbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQ=
        owner: root:root
        path: /etc/systemd/system/consul.service
        permissions: '0644'

power_state:
  delay: "+30"
  mode: reboot
  message: "We completed!! So, reboot.."
  timeout: 10
  condition: True